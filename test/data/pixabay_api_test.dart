import 'package:flutter_test/flutter_test.dart';
import 'package:image_search/data/data_source/pixabay_api.dart';
import 'package:image_search/data/repository/photo_api_repository_impl.dart';
import 'package:mockito/annotations.dart';
import 'package:http/http.dart' as http;
import 'package:mockito/mockito.dart';

import 'pixabay_api_test.mocks.dart';

@GenerateMocks([http.Client])
void main() {
  test('Pixabay data 를 잘 가져와야한다.', () async {
    const query = 'apple';

    final client = MockClient();
    final api = PhotoApiRepositoryImpl(PixabayApi(client));

    when(client.get(Uri.parse(
            '${PixabayApi.baseUrl}?key=${PixabayApi.key}&q=$query&image_type=photo')))
        .thenAnswer((_) async => http.Response(sampleJsonBody, 200));

    final result = await api.fetch(
      query,
    );

    expect(result.first.id, 1834639);

    verify(client.get(Uri.parse(
        '${PixabayApi.baseUrl}?key=${PixabayApi.key}&q=$query&image_type=photo')));
  });
}

String sampleJsonBody =
    """{"total":8540,"totalHits":500,"hits":[{"id":1834639,"pageURL":"https://pixabay.com/photos/apple-red-fruit-food-fresh-ripe-1834639/","type":"photo","tags":"apple, red, fruit","previewURL":"https://cdn.pixabay.com/photo/2016/11/18/13/47/apple-1834639_150.jpg","previewWidth":150,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g60f68dafc07c1dea4092266a1ea79caf367c02a8b231af4d940d69b2001074d6fe154c0af49e4eb5292de103600df03ebe9f6b825f9d5f974cf563adc291c6f8_640.jpg","webformatWidth":640,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/gcea5ea011a98e5c096c657aa1ad765818ffbed2041ae67d79c6776728a267ed3f3168583fc0ba4f058b60a74a8d3c0ba7432453f2a16e1cab071277e3f07ffd3_1280.jpg","imageWidth":2827,"imageHeight":2827,"imageSize":1022194,"views":65837,"downloads":39096,"collections":2337,"likes":159,"comments":38,"user_id":2286921,"user":"Pexels","userImageURL":"https://cdn.pixabay.com/user/2016/03/26/22-06-36-459_250x250.jpg"},{"id":1122537,"pageURL":"https://pixabay.com/photos/apple-water-droplets-fruit-moist-1122537/","type":"photo","tags":"apple, water droplets, fruit","previewURL":"https://cdn.pixabay.com/photo/2016/01/05/13/58/apple-1122537_150.jpg","previewWidth":150,"previewHeight":95,"webformatURL":"https://pixabay.com/get/g73e07e79d6671f06556aa21efe6f733f76e085c20c9730dfcf74e63488cd3ed52f146c8f4de1f342fe977e4a6628ea0dadf73c1f40cdfc60a927c32c336b0d8a_640.jpg","webformatWidth":640,"webformatHeight":409,"largeImageURL":"https://pixabay.com/get/g250eb2eb0c36163641ecefec6719fbbed1689b0f9127d0a01d2a00bc47d346200f7d5a38aac33201ee2e36dc77629fa721e880c4c6982843be660f0eb46798bb_1280.jpg","imageWidth":4752,"imageHeight":3044,"imageSize":5213632,"views":245350,"downloads":138895,"collections":3590,"likes":1028,"comments":159,"user_id":1445608,"user":"mploscar","userImageURL":"https://cdn.pixabay.com/user/2016/01/05/14-08-20-943_250x250.jpg"},{"id":2788599,"pageURL":"https://pixabay.com/photos/apples-red-apple-ripe-apple-orchard-2788599/","type":"photo","tags":"apples, red apple, ripe","previewURL":"https://cdn.pixabay.com/photo/2017/09/26/13/21/apples-2788599_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/ge837c6afdadbda038b13882a8b8f9dc4c358dd67d36e434d4b83d71bb180439b974f8f64d6701de2b85dcf7b438f441fb398ff37588662f76d37fdc1747baa46_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g253e9e7242b11867cd57ba86006ea933f6d61502a6107e4e604619f51db3ea06694896b9681b210d48d9c4c3a3f30c83814281db43c543d4e30dc673a35fd99a_1280.jpg","imageWidth":6000,"imageHeight":4000,"imageSize":3660484,"views":106376,"downloads":57193,"collections":1864,"likes":602,"comments":59,"user_id":2364555,"user":"pixel2013","userImageURL":"https://cdn.pixabay.com/user/2020/07/25/21-10-11-80_250x250.jpg"},{"id":2788616,"pageURL":"https://pixabay.com/photos/apple-red-red-apple-2788616/","type":"photo","tags":"apple, red, red apple","previewURL":"https://cdn.pixabay.com/photo/2017/09/26/13/31/apple-2788616_150.jpg","previewWidth":150,"previewHeight":90,"webformatURL":"https://pixabay.com/get/ge69bed17a5432584be5a2f98ddf1e20bd644fa4e6e74f3bd38c57965ddf47acf83708464a401666eaaa41c91a9b7e5d3f23eec9f8cf9b7e031e15b8a5e7060a5_640.jpg","webformatWidth":640,"webformatHeight":384,"largeImageURL":"https://pixabay.com/get/ga971ade9037f9585517c8ae6220b35f9ffeaecc4762c815873f9eb019111f09ea8a274b8e343005e7b19a6ed8d1fb955abf9f162a915ee47aa710bc5ecab836c_1280.jpg","imageWidth":6000,"imageHeight":3601,"imageSize":2758033,"views":81230,"downloads":44227,"collections":1443,"likes":440,"comments":36,"user_id":2364555,"user":"pixel2013","userImageURL":"https://cdn.pixabay.com/user/2020/07/25/21-10-11-80_250x250.jpg"},{"id":256261,"pageURL":"https://pixabay.com/photos/apple-books-still-life-fruit-food-256261/","type":"photo","tags":"apple, books, still life","previewURL":"https://cdn.pixabay.com/photo/2014/02/01/17/28/apple-256261_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g1b7ee54f337ff9b569e4452c1907c065776c86826c4791f6dc898ba449a67a15492e440f93725d6455839ed1196d7dad_640.jpg","webformatWidth":640,"webformatHeight":423,"largeImageURL":"https://pixabay.com/get/g038de84acf59a44f81659b1245812bb9c0e99a36443b5555859ccb11466016a1824063cb28fb72b0d6049992be4ff557720706df3296fb9e1d4adde60f0d2ada_1280.jpg","imageWidth":4928,"imageHeight":3264,"imageSize":2987083,"views":408539,"downloads":197401,"collections":4091,"likes":989,"comments":224,"user_id":143740,"user":"jarmoluk","userImageURL":"https://cdn.pixabay.com/user/2019/09/18/07-14-26-24_250x250.jpg"},{"id":1868496,"pageURL":"https://pixabay.com/photos/apple-computer-desk-workspace-1868496/","type":"photo","tags":"apple, computer, desk","previewURL":"https://cdn.pixabay.com/photo/2016/11/29/08/41/apple-1868496_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g7b81333880b4c26446ff1ef48f21cdd89bbc2e52ab217f05da64a9600173c8c27a488d177bab404db813fa8cc296fc84025818fccb06cff90536f6e3bea43a63_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g833246c13f6085610379535fb607fbca7a6bb03b4105fdc330877031795e71a12688883c5d3857a4c09f6ea51df11a4a955abb09580ef11310505db266a98ce0_1280.jpg","imageWidth":5184,"imageHeight":3456,"imageSize":2735519,"views":525846,"downloads":386653,"collections":6669,"likes":882,"comments":235,"user_id":2286921,"user":"Pexels","userImageURL":"https://cdn.pixabay.com/user/2016/03/26/22-06-36-459_250x250.jpg"},{"id":2788662,"pageURL":"https://pixabay.com/photos/apple-red-hand-apple-plantation-2788662/","type":"photo","tags":"apple, red, hand","previewURL":"https://cdn.pixabay.com/photo/2017/09/26/13/42/apple-2788662_150.jpg","previewWidth":150,"previewHeight":88,"webformatURL":"https://pixabay.com/get/gd3d98ef7bfafcfabd0a64fd3a728bcd34775b69d439a0bb8e6ddfc68eb2523aad63a5912ae4406f0c5f65e15859577be3bbe399240bb933c3f98b0c3f26eaa10_640.jpg","webformatWidth":640,"webformatHeight":377,"largeImageURL":"https://pixabay.com/get/g445358434958b8b247431d1a82f2494acd2b5ce174cb7ee37ee001e5e602d0cabc5b60874675bd3b3b39313c1f4c09606ebad6aa90ff9c9b4d9d1d2d3cc29023_1280.jpg","imageWidth":6000,"imageHeight":3539,"imageSize":2042422,"views":121038,"downloads":67252,"collections":1741,"likes":547,"comments":78,"user_id":2364555,"user":"pixel2013","userImageURL":"https://cdn.pixabay.com/user/2020/07/25/21-10-11-80_250x250.jpg"},{"id":1873078,"pageURL":"https://pixabay.com/photos/apples-orchard-apple-trees-1873078/","type":"photo","tags":"apples, orchard, apple trees","previewURL":"https://cdn.pixabay.com/photo/2016/11/30/15/23/apples-1873078_150.jpg","previewWidth":150,"previewHeight":95,"webformatURL":"https://pixabay.com/get/g16a3a259bb7d242a820e3f5360eeb395467b3cdd6cf20bb92e4b1877ca6bbbb668d5091c132fe9404ca3731d85bbec32251f3cbf44221932d4c9778003600e4e_640.jpg","webformatWidth":640,"webformatHeight":408,"largeImageURL":"https://pixabay.com/get/g083e66fdd30159c376107eafb3e1c8628871c18b746cb8da9dbec00e29aeeaee0b0ed551d5a4f3c44b6f2948f4d9a34e61ae8766d2855ae0e1d67a273e2616dd_1280.jpg","imageWidth":3212,"imageHeight":2051,"imageSize":2581012,"views":324704,"downloads":177947,"collections":4211,"likes":1017,"comments":139,"user_id":3890388,"user":"lumix2004","userImageURL":""},{"id":805124,"pageURL":"https://pixabay.com/photos/apples-basket-fruits-apple-basket-805124/","type":"photo","tags":"apples, basket, fruits","previewURL":"https://cdn.pixabay.com/photo/2015/06/10/19/56/apples-805124_150.jpg","previewWidth":150,"previewHeight":129,"webformatURL":"https://pixabay.com/get/gd84b4afac9fbaa813272107b03af49b411f077f1d64d5914fbb2cda1c72bf4bf50f745b59994918e42043749c76211f8_640.jpg","webformatWidth":640,"webformatHeight":553,"largeImageURL":"https://pixabay.com/get/ga195d9e9d09a0021871550c1193106b9fee1097f03ea9021268b6e60f16ee3b7b68f183d470af84ac97c3cd86920cd2cbf9da2b7cdadeaf7ab32fed30d5c0411_1280.jpg","imageWidth":3101,"imageHeight":2683,"imageSize":998659,"views":110496,"downloads":61562,"collections":1863,"likes":448,"comments":79,"user_id":1107275,"user":"Larisa-K","userImageURL":"https://cdn.pixabay.com/user/2015/06/13/06-38-56-116_250x250.jpg"},{"id":256263,"pageURL":"https://pixabay.com/photos/apple-books-classroom-red-apple-256263/","type":"photo","tags":"apple, books, classroom","previewURL":"https://cdn.pixabay.com/photo/2014/02/01/17/28/apple-256263_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g2a49951fc7d3d137ea49adeddb6acc84d708a65bf02a674ce095978889a8c2c96d46a1dcb046a9636471dd3dc8f45ead_640.jpg","webformatWidth":640,"webformatHeight":423,"largeImageURL":"https://pixabay.com/get/gb27cb1e744b4fbae1ad4af4269338a9dee9eb97601501f2b4d882d6d9bf7938636f3ba1d79a9a272f83c8b6e3d19700379fb12985122678089d643b3f2ddfc74_1280.jpg","imageWidth":4928,"imageHeight":3264,"imageSize":2864273,"views":200487,"downloads":103771,"collections":1643,"likes":522,"comments":95,"user_id":143740,"user":"jarmoluk","userImageURL":"https://cdn.pixabay.com/user/2019/09/18/07-14-26-24_250x250.jpg"},{"id":3860991,"pageURL":"https://pixabay.com/photos/apples-crisp-ripe-market-sale-3860991/","type":"photo","tags":"apples, crisp, ripe","previewURL":"https://cdn.pixabay.com/photo/2018/12/07/01/53/apples-3860991_150.jpg","previewWidth":150,"previewHeight":100,"webformatURL":"https://pixabay.com/get/g0c69c691aa616b91e031ad8c74f6cd29374d4d4584aad088df88bbe6e3114b142696f9de4a948b46ace384e424318371f18acf11a5fb45bfc34657e7d3914183_640.jpg","webformatWidth":640,"webformatHeight":427,"largeImageURL":"https://pixabay.com/get/g612d0e06fa0b98519e09e45c46d31df509e900a4425deb83f22e74e888d7fa1dab9a63a8840f6a220c82b4308047b0b9b72f16c8e9cc656504088f91c981a053_1280.jpg","imageWidth":6016,"imageHeight":4016,"imageSize":4811041,"views":23728,"downloads":14983,"collections":932,"likes":118,"comments":46,"user_id":1834854,"user":"ulleo","userImageURL":"https://cdn.pixabay.com/user/2019/05/16/18-48-21-135_250x250.jpg"},{"id":256268,"pageURL":"https://pixabay.com/photos/apple-red-delicious-fruit-vitamins-256268/","type":"photo","tags":"apple, red, delicious","previewURL":"https://cdn.pixabay.com/photo/2014/02/01/17/30/apple-256268_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gfcf0265cd88474c5a9c7a96dcbbd7171ea1c837bd9fe2ef9a8f30a4643485b6de4f2c2da00d84e47584c2913c1e099b7_640.jpg","webformatWidth":640,"webformatHeight":423,"largeImageURL":"https://pixabay.com/get/g2df1c13dfa7a998b766462620bdeb6dcff7ea7ba555298e25d055e14c9dc5c812cef3864003a0e0a6295fbbfbcb61f7dec37bb281e85b581ed5e4371cbcc86c1_1280.jpg","imageWidth":4928,"imageHeight":3264,"imageSize":2942037,"views":66723,"downloads":29559,"collections":737,"likes":263,"comments":36,"user_id":143740,"user":"jarmoluk","userImageURL":"https://cdn.pixabay.com/user/2019/09/18/07-14-26-24_250x250.jpg"},{"id":410324,"pageURL":"https://pixabay.com/photos/iphone-smartphone-apps-apple-inc-410324/","type":"photo","tags":"iphone, smartphone, apps","previewURL":"https://cdn.pixabay.com/photo/2014/08/05/10/30/iphone-410324_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/gccc6867e6847f973f5340339dbd867e5feb91a379522d68e0deabe79165173752c8ba206751edcb70c587c30b618b947_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g25b1ff014b74f219b9e7e05936da5dc557bca1b86f0f6a95fe1f68794406d6390863041fbe9a812926cfc366c93611fa22c119425d4fb162a353f93de82c3046_1280.jpg","imageWidth":2180,"imageHeight":1453,"imageSize":477025,"views":609637,"downloads":340150,"collections":5296,"likes":777,"comments":190,"user_id":264599,"user":"JESHOOTS-com","userImageURL":"https://cdn.pixabay.com/user/2014/06/08/15-27-10-248_250x250.jpg"},{"id":1872997,"pageURL":"https://pixabay.com/photos/apples-fruits-orchard-nature-trees-1872997/","type":"photo","tags":"apples, fruits, orchard","previewURL":"https://cdn.pixabay.com/photo/2016/11/30/15/00/apples-1872997_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/ga3c5dbead53c8c64364962e1e84f0bb5f9dcf2d4231d6505f4c084ee76f85eed2a5c041b5cdd07c69ac350c363b317036ff166330d00f5fe05cd71c6aee6317b_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/g3d3380a912b56b8dfd897f5d21ca5968b94d60d050f933b46fdb78388ae035642d07645aed0519bbda8e0be9cfec80c8b8b7ee120578e08710efcb66ad4966a5_1280.jpg","imageWidth":3504,"imageHeight":2336,"imageSize":2019234,"views":155967,"downloads":94378,"collections":3135,"likes":568,"comments":76,"user_id":3890388,"user":"lumix2004","userImageURL":""},{"id":606761,"pageURL":"https://pixabay.com/photos/apple-imac-ipad-workplace-606761/","type":"photo","tags":"apple, imac, ipad","previewURL":"https://cdn.pixabay.com/photo/2015/01/21/14/14/apple-606761_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/ge5620c711f3a044aceaffd9cd50154bbfdb474830075766eea92e1c1a173bcfd5f686f3301be4e1294d99de69c5385a1_640.jpg","webformatWidth":640,"webformatHeight":425,"largeImageURL":"https://pixabay.com/get/ged7b0d161a6e5f30823645dcc4542635dab4473ac07b4b27075cb25cea2ba6508fe0bdda767017a9a5699e01387dcf3ee6d0be54e7c0ccf7227223ec363e837a_1280.jpg","imageWidth":4209,"imageHeight":2796,"imageSize":1649126,"views":355864,"downloads":190663,"collections":2581,"likes":502,"comments":106,"user_id":663163,"user":"Firmbee","userImageURL":"https://cdn.pixabay.com/user/2020/11/25/09-38-28-431_250x250.png"},{"id":3580560,"pageURL":"https://pixabay.com/photos/apples-fruits-food-vitamins-sliced-3580560/","type":"photo","tags":"apples, fruits, food","previewURL":"https://cdn.pixabay.com/photo/2018/08/02/21/51/apples-3580560_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g22d44babd2e24875e41d926f2556bce5355047535ade44dc6b3440fb18aa6506c24fa8348368a60794860928e7cff95a5d474b9073973c897108b1e56429107d_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/gd4cce02cc9368812d8c6b60066a07699bb57fb0be64355e70eac77b00e131403ba3124d597dc3a21c0d7e9990ead7d023714f161c7aeb47fcbdd57ebb1fe3e95_1280.jpg","imageWidth":6000,"imageHeight":4000,"imageSize":3704994,"views":115409,"downloads":85822,"collections":865,"likes":298,"comments":99,"user_id":6355831,"user":"pasja1000","userImageURL":"https://cdn.pixabay.com/user/2021/02/06/02-19-29-704_250x250.png"},{"id":1702316,"pageURL":"https://pixabay.com/photos/apple-red-fruit-red-chief-1702316/","type":"photo","tags":"apple, red, fruit","previewURL":"https://cdn.pixabay.com/photo/2016/09/29/08/33/apple-1702316_150.jpg","previewWidth":150,"previewHeight":116,"webformatURL":"https://pixabay.com/get/gcaae258bf352c4d633e746e8c2257d9471e9aa7ccc4ca8eb3440955c0880acbf657912c469e93c4b6d41b0fa60b5ff4174f57c0de0d4bc59e74f6ef6ae6e911c_640.jpg","webformatWidth":640,"webformatHeight":495,"largeImageURL":"https://pixabay.com/get/g1894ca6d592bef865eeb64f0f73e8f4cdef4c1a98a4dd4ca749998e4d239673f4ee22e64d8df9b116d36fb1b4439c6a552a2c923b152a74235315d57a5f1ca45_1280.jpg","imageWidth":4000,"imageHeight":3099,"imageSize":1930833,"views":99876,"downloads":64389,"collections":765,"likes":341,"comments":31,"user_id":2364555,"user":"pixel2013","userImageURL":"https://cdn.pixabay.com/user/2020/07/25/21-10-11-80_250x250.jpg"},{"id":2391,"pageURL":"https://pixabay.com/photos/apple-diet-female-food-fresh-2391/","type":"photo","tags":"apple, diet, female","previewURL":"https://cdn.pixabay.com/photo/2010/12/13/10/09/apple-2391_150.jpg","previewWidth":150,"previewHeight":99,"webformatURL":"https://pixabay.com/get/g64882adac777ec2f07167e22f05f95ba81d2820b705693e177cb2d68c94b6f48cc36646d7b2c8033adec2efa403d59c4_640.jpg","webformatWidth":640,"webformatHeight":426,"largeImageURL":"https://pixabay.com/get/gbf11bcce55d474c84a18b988984e0491f287e11513a0c955fc962cd7e6761d14b55bb77d793a9ab62f72072062b53f95_1280.jpg","imageWidth":4752,"imageHeight":3168,"imageSize":752002,"views":97867,"downloads":56148,"collections":1008,"likes":276,"comments":31,"user_id":14,"user":"PublicDomainPictures","userImageURL":"https://cdn.pixabay.com/user/2012/03/08/00-13-48-597_250x250.jpg"},{"id":634572,"pageURL":"https://pixabay.com/photos/apples-fruits-red-ripe-vitamins-634572/","type":"photo","tags":"apples, fruits, red","previewURL":"https://cdn.pixabay.com/photo/2015/02/13/00/43/apples-634572_150.jpg","previewWidth":100,"previewHeight":150,"webformatURL":"https://pixabay.com/get/g74556a7c69a0e64d52513387e1f842bdf20b02f36804d0c99ab2a90230971a95422e46b3eb34deb95ce730f68818bd9a_640.jpg","webformatWidth":427,"webformatHeight":640,"largeImageURL":"https://pixabay.com/get/gd398fdd2fab8eff5e3ca6fc91d83ad7ace7c751b32e544dfd3898c444fd4c19a4898cb8c43e5c74f310e94756028e012fa76e1ac446deb1e3f938a378d503751_1280.jpg","imageWidth":3345,"imageHeight":5017,"imageSize":811238,"views":382417,"downloads":212740,"collections":2537,"likes":2320,"comments":174,"user_id":752536,"user":"Desertrose7","userImageURL":"https://cdn.pixabay.com/user/2016/03/14/13-25-18-933_250x250.jpg"},{"id":1776744,"pageURL":"https://pixabay.com/photos/apples-leaves-fall-still-life-1776744/","type":"photo","tags":"apples, leaves, fall","previewURL":"https://cdn.pixabay.com/photo/2016/10/27/22/52/apples-1776744_150.jpg","previewWidth":150,"previewHeight":100,"webformatURL":"https://pixabay.com/get/g05457bb6489f3ada0bedec538a4e494deef895b001b7cb73bf0acacadb1cd1662ee13c844725207a741dc272bc6c7be504282eaa41f1fa4c140be0bd282e634f_640.jpg","webformatWidth":640,"webformatHeight":427,"largeImageURL":"https://pixabay.com/get/gb3771530b8e73ceb62e619050e5fa2a9ee626a552473094d474242c434fbdd4a9da3170e0e20f688f4d3177bb014311fe40df1f2f197d35a065e51389f268807_1280.jpg","imageWidth":4193,"imageHeight":2798,"imageSize":2002268,"views":129648,"downloads":74795,"collections":4022,"likes":536,"comments":71,"user_id":2970404,"user":"castleguard","userImageURL":"https://cdn.pixabay.com/user/2016/09/18/22-38-35-578_250x250.jpg"}]}
""";
